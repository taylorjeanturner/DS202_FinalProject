---
title: "DS202_FinalProject"
author: "Ryan Lode, Taylor Turner, Jonathan Kelly, Molly Carrick, Max Wisnieski"
date: "11/18/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=FALSE, message= FALSE}
library(dplyr)
library(lubridate)
library(tidyverse)
library(RColorBrewer)
library(ggrepel)
```

```{r}


```

## Background and Questions Raised ##

For our final report, we decided to examine data on the prison population in Iowa. Ongoing problems relating to mass incarceration, law enforcement and judicial bias, as well as recent civil unrest, point to the relevancy of this analysis. Our data was obtained from the Iowa Department of Correction, containing information on prisoner age, sex, Race/Ethnicity, offense type, and other information. In this report, we examined potential paterns among incarcerated persons, seeking answers to following questions:

**Question 1: **Does gender play a role in the type of offense committed?  
**Question 2: **Is either gender underrepresented in Iowa prisons?  
**Question 3: **How is ethnicity represented in Iowa prisons?  
**Question 4: **Is there a relationship between prisoner age and offense type?  
**Question 5: **Does education level impact the probability of being incarcerated for a certain crime?  
**Question 6: **How does one's education level and race/ethnicity impact the length of time spent incarcerated?  
**Question 7: **Does race/ethnicity affect the amount of time served for similar crimes?  
**Question 8: **What factors might lead someone to reoffend after being released?  
**Question 9: **How does time served depend on the offense type?  
**Question 10:**How do the ranges of time served for each offense type compare?  



# Exploratory Analysis #


## Education level and crime subtype ##

**Question 5: **Does a person's education level impact the probability of being incarcerated for a certain crime?  

To answer this, the following steps were undertaken to clean/process the data:  

*Step 1: Reading in data and initial processing*  

A new dataframe, prisonData was generated by reading in the prison population data. Then, the education levels were reordered from lower education to higher education. Some values in the education category column were completely blank, so they were filled with NA values. Those NA values were used to filter out the unknown education rows into a new data frame prisonData2.


```{r, warning=FALSE}
prisonData <- read.csv('./Current_Iowa_Correctional_System_Prison_Population.csv')
prisonData$Education.Category <- factor(prisonData$Education.Category , levels = c('No HS Diploma','HS Diploma or Equivelent','Post-Secondary'))
prisonData$Education.Category[prisonData$Education.Category == ""] <-NA
prisonData2 <- prisonData %>%
filter(!is.na(Education.Category))

```

*Step 2: Reassigning small offense subtype categories*   
One of the difficulties faced in this analysis was the very small offense subtype categories. For example, the 'Stolen Property' subtype was a single datapoint. For better visualization, this was moved to theft category. A similar decision was made for the animals, prostituion/pimping, alcohol, and other small categories. There were a few other reassignments, that were done by methodically examining the data. For example, datapoints where the description was 'Burglary 1st degree' were not originally grouped into the burglary category. Additionally, attempted burgulary was moved to the burglary category since the criminal intent was the same
```{r}

prisonData2$Offense.Subtype <- as.factor(prisonData2$Offense.Subtype)

prisonData2$Offense.Subtype[prisonData2$Offense.Subtype == 'Stolen Property'] <- 'Theft'
#1 datapoint, similar type of crime
prisonData2$Offense.Subtype[prisonData2$Offense.Subtype == 'Animals'] <- 'Other Violent'
#1 data point, Crime: Animal Torture was judged to belong in Other Violent due to heinousness of crime
prisonData2$Offense.Subtype[prisonData2$Offense.Subtype == 'Prostitution/Pimping'] <- 'Sex' 
#4 data points in this category, sex crime related
prisonData2$Offense.Subtype[prisonData2$Offense.Description == 'BURGLARY 1ST DEGREE'] <- 'Burglary' 
#For analysis, this is more meaningful in the burglary category
prisonData2$Offense.Subtype[prisonData2$Offense.Description == 'ATTEMPT BURGLARY 1ST DEGREE'] <- 'Burglary'
#Grouped with burglarly since the criminal intent was the same 
prisonData2$Offense.Subtype[prisonData2$Offense.Subtype == 'Alcohol']<- 'Other Criminal' 
#1 data point, Other criminal seemed best categorical fit
prisonData2$Offense.Subtype[prisonData2$Offense.Subtype == 'Flight/Escape']<- 'Other Criminal' 
#Only 16 data points, Other criminal seemed best categorical fit
prisonData2$Offense.Subtype[prisonData2$Offense.Subtype == 'Other Drug']<- 'Other Criminal' 
#Only 24 datapoints, Offense description included descriptions such as 'failure to affix Tax Stamp'
prisonData2$Offense.Subtype[prisonData2$Offense.Subtype == 'Vandalism']<- 'Other Criminal' 
#Only 52 datapoints, 
prisonData2$Offense.Subtype[prisonData2$Offense.Subtype == 'Arson']<- 'Other Violent' 
#Only 57 datapoints, barely visible in original plot, moved to Other Violent due to heinousness of crime
prisonData2$Offense.Subtype[prisonData2$Offense.Subtype == 'OWI']<- 'Other Public Order'
prisonData2$Offense.Subtype[prisonData2$Offense.Subtype == 'Traffic']<- 'Other Public Order' 
#Only 60 data points, general offense type already classified as Public Order 
prisonData2$Offense.Subtype[prisonData2$Offense.Subtype == 'Weapons']<- 'Other Public Order' 
#Offense type already classified as public Order and most serious was aggravated misdemeanor 
```

*Step 3: Preparation for Plotting*  

A newdataframe, prisonData3 was generated by filtering out offense subtype categories that are no longer used. The vector plotColors was made by combining a single color from the "Dark2" palette to the "Paired" color palette. This was done because the number of colors in the "Paired" color palette was just insufficient to match the number of offense subtype categories. This was used to generate a stacked bar chart, faceted by education category. 

```{r, warning= FALSE}

prisonData3 <- prisonData2 %>%
  filter(!Offense.Subtype %in% c('Arson','Alcohol', 'Animals','Flight/Escape', 'None', 'Other Drug','OWI','Prostitution/Pimping','Stolen Property','Traffic', 'Vandalism','Weapons'))

plotColors = c((brewer.pal(name="Dark2", n = 1)), brewer.pal(name="Paired", n = 12))

ggplot(data = prisonData3, aes(x = Education.Category, fill = Offense.Subtype)) + geom_bar(position = 'fill') + scale_fill_manual(values = plotColors, name = 'Offense Type') + ggtitle('Proportional Breakdown of Offense Type by Education Level') + xlab('Education Level') + ylab('Relative Frequency')

```

**Analysis: **There are several categories that proportionally, don't seem to change by education level. This is not the case for all categories, however, as the probability of a person being incarcerated due to assault or burglary does seem to decline with increasing education level. Additionally, the probability of being incarcerated for a sex crime seems to increase with higher levels of education.

## Education level, Race/Ethnicity impact on length of incarceration ##

**Question 6: **How does one's education level and race/ethnicity impact the length of time spent incarcerated?

*Cleaning, Processing, and then Plotting:*

A new dataframe, prisonData5, was created from the prisonData2 dataframe. Because the number of Hispanic, American Indian or Alaska Native, and Asian or Pacific Islanders was very small, this made meaningful visualization difficult. To adjust for this, those groups were all reassigned to the Race/Ethnicity category 'His/AP/Ind'. In doing this, we are aware of the pitfalls of grouping people from such diverse racial/ethnic groups together, and this analysis does not imply that those groups are at all the same.This was *only* done for clean visualization purposes. In this analysis, that category should simply be viewed as 'Not Black or White' at a high level. Once this was done, a plot could then be created. The distribution of the length of time served was generated by plotting the Months.served column on the x-axis with geom_histogram. This plot was then faceted by race/ethnicity and education level. 

```{r, message= FALSE}
prisonData5 <-prisonData2

prisonData5$Race...Ethnicity[prisonData5$Race...Ethnicity == 'Hispanic'] <-'His/AP/Ind' 
prisonData5$Race...Ethnicity[prisonData5$Race...Ethnicity == 'American Indian or Alaska Native'] <-'His/AP/Ind' 
prisonData5$Race...Ethnicity[prisonData5$Race...Ethnicity == 'Asian or Pacific Islander'] <-'His/AP/Ind'

prisonData5a <- prisonData5
prisonData5$Race...Ethnicity <- as.factor(prisonData5$Race...Ethnicity)


ggplot(data = prisonData5, aes(x = Months.Served, fill = Race...Ethnicity)) + geom_histogram(position = 'stack') + facet_wrap(Race...Ethnicity~Education.Category, scales = 'free') + ggtitle('Distribution of Time Served by Education Level-Faceted by Race/Ethnicity') + xlab('Months Served') + ylab('Count')

```

**Analysis: **Each distribution in this plot is unimodal, and right-skewed, with the vast majority of incarcerated people having served under a 100 months. However, there were several individual histograms with a very small maximum y value, in the post-secondary education plots. At a cursory glance, race/ethnicity and education don't appear to have much of an impact on the length of time incarcerated. However, summary statistics generated later (not shown), indicated that white prisoners appeared to have a slightly lower median incarceration time across all educational levels, except those in the His/AP/Ind category with Post-Secondary Educations. 

